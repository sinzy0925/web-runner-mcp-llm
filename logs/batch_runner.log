2025-04-19 18:46:53,826 - [INFO] [__main__:151] --- バッチテスト開始 (入力: web_runner_mcp_llm_batch_test_actions.json) ---
2025-04-19 18:46:53,828 - [INFO] [__main__:157] 1 件のテストケースを読み込みました。
2025-04-19 18:46:53,828 - [INFO] [__main__:165] 
========================================
2025-04-19 18:46:53,828 - [INFO] [__main__:165] [1/1] 実行中: Google_Search_Scenario
2025-04-19 18:46:53,828 - [INFO] [__main__:166]   開始URL: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1
2025-04-19 18:46:53,829 - [INFO] [__main__:183] --- ステップ 1/5: Google_Search_Scenario ---
2025-04-19 18:46:53,829 - [INFO] [__main__:184]   指示: 検索ボックスに「Playwright」と入力して
2025-04-19 18:46:53,829 - [INFO] [__main__:197] ステップ1: HTML再取得 (URL: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1)
2025-04-19 18:46:53,830 - [INFO] [__main__:96] HTML取得開始: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1
2025-04-19 18:46:53,830 - [INFO] [playwright_launcher:88] --- Playwright 自動化開始 (非同期) ---
2025-04-19 18:46:54,995 - [INFO] [playwright_launcher:103] --- Initial attempt (with Stealth Mode) ---
2025-04-19 18:46:54,995 - [INFO] [playwright_launcher:46] ブラウザ起動 (Chromium, Headless: False, SlowMo: 0ms)...
2025-04-19 18:46:55,333 - [INFO] [playwright_launcher:51] 新しいブラウザコンテキストを作成します...
2025-04-19 18:46:55,362 - [INFO] [playwright_launcher:61] コンテキストのデフォルトタイムアウトを 60000ms に設定しました。
2025-04-19 18:46:55,362 - [INFO] [playwright_launcher:64] Applying stealth mode to the context...
2025-04-19 18:46:55,448 - [INFO] [playwright_launcher:67] Stealth mode applied successfully.
2025-04-19 18:46:55,448 - [INFO] [playwright_launcher:109] 新しいページを作成します...
2025-04-19 18:46:55,644 - [INFO] [playwright_launcher:115] 最初のナビゲーション: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1 (タイムアウト: 180000ms)...
2025-04-19 18:46:58,069 - [INFO] [playwright_launcher:119] 最初のナビゲーション成功。
2025-04-19 18:46:58,071 - [INFO] [playwright_launcher:122] Checking for stealth error message...
2025-04-19 18:46:59,114 - [WARNING] [playwright_launcher:130] 検出されたエラーメッセージ: "大変申し訳ありませんが、ページを正しく表示できませんでした。
推奨されているブラウザであるかをご確認の上、時間をおいて再度お試しください。"
2025-04-19 18:46:59,114 - [WARNING] [playwright_launcher:131] Stealth mode may be blocked. Retrying without stealth mode...
2025-04-19 18:46:59,115 - [INFO] [playwright_launcher:136] Closing current browser and context for retry...
2025-04-19 18:46:59,431 - [INFO] [playwright_launcher:142] --- Retry attempt (without Stealth Mode) ---
2025-04-19 18:46:59,431 - [INFO] [playwright_launcher:46] ブラウザ起動 (Chromium, Headless: False, SlowMo: 0ms)...
2025-04-19 18:46:59,790 - [INFO] [playwright_launcher:51] 新しいブラウザコンテキストを作成します...
2025-04-19 18:46:59,811 - [INFO] [playwright_launcher:61] コンテキストのデフォルトタイムアウトを 60000ms に設定しました。
2025-04-19 18:46:59,811 - [INFO] [playwright_launcher:71] Stealth mode is disabled for this context.
2025-04-19 18:46:59,812 - [INFO] [playwright_launcher:147] 新しいページを作成します (リトライ)...
2025-04-19 18:47:00,030 - [INFO] [playwright_launcher:151] 再ナビゲーション: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1 (タイムアウト: 180000ms)...
2025-04-19 18:47:02,276 - [INFO] [playwright_launcher:154] 再ナビゲーション成功。
2025-04-19 18:47:02,276 - [INFO] [playwright_launcher:170] アクションの実行を開始します...
2025-04-19 18:47:02,277 - [INFO] [playwright_actions:153] --- ステップ 1/1: Action='get_inner_html' ---
2025-04-19 18:47:02,277 - [INFO] [playwright_actions:159] 詳細: selector='html' (timeout: 60000ms)
2025-04-19 18:47:02,390 - [INFO] [playwright_actions:169] 現在のルートページ: URL='https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1', Title='ライティング・記事作成の仕事・求人を探す | 在宅ワーク・副業するなら【クラウドワークス】'
2025-04-19 18:47:02,391 - [INFO] [playwright_actions:170] 現在の探索スコープ: Page
2025-04-19 18:47:02,391 - [INFO] [playwright_actions:264] 単一要素 'html' (状態: attached) を動的に探索します...
2025-04-19 18:47:02,391 - [INFO] [playwright_finders:34] 動的探索(単一)開始: 起点=Page, セレクター='html', 最大深度=2, 状態='attached', 全体タイムアウト=60000ms
2025-04-19 18:47:02,434 - [INFO] [playwright_finders:65] 要素 'html' をスコープ 'Page' (深度 0) で発見。(47ms)
2025-04-19 18:47:02,435 - [INFO] [playwright_actions:283] 最終的な単一操作対象スコープ: Page
2025-04-19 18:47:02,435 - [INFO] [playwright_actions:374] 要素の innerHTML を取得します...
2025-04-19 18:47:02,454 - [INFO] [playwright_actions:376] 取得HTML(innerHTML):
<script src="//bat.bing.com/bat.js" async=""></script><script async="" src="https://www.clarity.ms/tag/7xxi9n9q71"></script><script type="text/javascript" async="" src="https://bat.bing.com/bat.js"></script><script type="text/javascript" async="" src="https://s.yimg.jp/images/listing/tool/cv/ytag.js"></script><script type="text/javascript" async="" src="https://www.googletagmanager.com/gtag/js?id=G-WC7RFDVS0V&amp;l=dataLayer&amp;cx=c&amp;gtm=45He54g3v6846820za200&amp;tag_exp=102803279~102813109~...
2025-04-19 18:47:02,454 - [INFO] [playwright_launcher:175] すべてのステップが正常に完了しました。
2025-04-19 18:47:02,454 - [INFO] [playwright_launcher:217] クリーンアップ処理を開始します...
2025-04-19 18:47:02,524 - [INFO] [playwright_launcher:221] ブラウザコンテキストを閉じました。
2025-04-19 18:47:02,724 - [INFO] [playwright_launcher:231] ブラウザを閉じました。
2025-04-19 18:47:02,742 - [INFO] [playwright_launcher:240] Playwright を停止しました。
2025-04-19 18:47:02,852 - [INFO] [playwright_launcher:248] --- Playwright 自動化終了 (非同期) ---
2025-04-19 18:47:02,852 - [INFO] [__main__:109] HTML取得成功 (URL: https://crowdworks.jp/public/jobs/search?category_id=228&order=new&page=1, Length: 87554)
2025-04-19 18:47:02,854 - [INFO] [root:45] HTMLクリーンアップ処理開始...
2025-04-19 18:47:02,864 - [INFO] [root:65]   - 1 個のコメントを削除しました。
2025-04-19 18:47:02,873 - [INFO] [root:95]   - 合計 56 個の指定タグを削除しました。
2025-04-19 18:47:02,873 - [INFO] [root:130]   - 合計 2 個の不要な属性を削除しました。
2025-04-19 18:47:02,876 - [INFO] [root:135] HTMLクリーンアップ完了 (処理時間: 0.02秒).
2025-04-19 18:47:02,877 - [INFO] [__main__:112] クリーンアップ後のHTMLサイズ: 39460
2025-04-19 18:47:02,877 - [INFO] [__main__:205] ステップ1: LLMでアクションJSON生成中...
2025-04-19 18:47:02,877 - [INFO] [generate_action_json_from_llm:101] ------------------------------
2025-04-19 18:47:02,877 - [INFO] [generate_action_json_from_llm:102] 指示に基づいて要素情報リスト、フォールバックセレクタ、アクション詳細を生成中: '検索ボックスに「Playwright」と入力して'
2025-04-19 18:47:02,877 - [INFO] [generate_action_json_from_llm:201] Gemini APIへのリクエスト送信 (試行 1/3)...
2025-04-19 18:47:05,235 - [INFO] [generate_action_json_from_llm:208] Gemini APIをJSONモードで呼び出しました。
2025-04-19 18:47:05,236 - [INFO] [generate_action_json_from_llm:215] Gemini API応答受信。処理時間: 2.36 秒
2025-04-19 18:47:05,236 - [INFO] [generate_action_json_from_llm:233] JSONオブジェクト形式の情報を正常に抽出・解析しました。
2025-04-19 18:47:05,236 - [INFO] [generate_action_json_from_llm:248] 抽出情報リスト (候補数: 3): [
  {
    "type": "placeholder",
    "value": "キーワードで検索",
    "confidence": "high"
  },
  {
    "type": "aria_label",
    "value": "キーワードで検索",
    "confidence": "medium"
  },
  {
    "type": "css_selector_candidate",
    "value": "[placeholder='キーワードで検索']",
    "confidence": "low"
  }
]
2025-04-19 18:47:05,237 - [INFO] [generate_action_json_from_llm:250] フォールバックセレクター: [placeholder='キーワードで検索']
2025-04-19 18:47:05,237 - [INFO] [generate_action_json_from_llm:252] アクション詳細: {"action_type": "input", "value": "Playwright", "attribute_name": null, "option_type": null, "option_value": null}
2025-04-19 18:47:05,238 - [INFO] [__main__:220] 生成JSON保存: Google_Search_Scenario_step1_generated.json
2025-04-19 18:47:05,239 - [INFO] [__main__:224] ステップ1: Web-Runnerを実行 (アクション: input)...
2025-04-19 18:47:19,775 - [ERROR] [__main__:264] ステップ 1 処理中にエラー: MCP実行失敗: {'error': 'MCP tool execution failed', 'raw_details': 'Error executing tool execute_web_runner: Unhandled server error during execution. Details: [\n  {\n    "step": "MCP Tool Execution",\n    "status": "error",\n    "message": "Unhandled server error occurred: ToolError. Please check server logs for details.",\n    "error_type": "ToolError",\n    "raw_error": "Web-Runner task failed. Details in JSON content: [\\n  {\\n    \\"step\\": 1,\\n    \\"status\\": \\"error\\",\\n    \\"action\\": \\"input\\",\\n    \\"selector\\": \\"[placeholder=\'キーワードで検索\']\\",\\n    \\"required_state\\": \\"visible\\",\\n    \\"message\\": \\"要素 \'[placeholder=\'キーワードで検索\']\' (状態: visible) が現在のスコープおよび探索可能なiframe (深さ2まで) 内で見つかりませんでした。\\"\\n  }\\n]"\n  }\n]'}
Traceback (most recent call last):
  File "C:\Users\sinzy\web-runner-mcp-llm\web_runner_mcp_llm_batch_test_actions.py", line 260, in run_batch_tests
    elif not step_mcp_success: raise RuntimeError(f"MCP実行失敗: {step_mcp_result_or_error}")
                               ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
RuntimeError: MCP実行失敗: {'error': 'MCP tool execution failed', 'raw_details': 'Error executing tool execute_web_runner: Unhandled server error during execution. Details: [\n  {\n    "step": "MCP Tool Execution",\n    "status": "error",\n    "message": "Unhandled server error occurred: ToolError. Please check server logs for details.",\n    "error_type": "ToolError",\n    "raw_error": "Web-Runner task failed. Details in JSON content: [\\n  {\\n    \\"step\\": 1,\\n    \\"status\\": \\"error\\",\\n    \\"action\\": \\"input\\",\\n    \\"selector\\": \\"[placeholder=\'キーワードで検索\']\\",\\n    \\"required_state\\": \\"visible\\",\\n    \\"message\\": \\"要素 \'[placeholder=\'キーワードで検索\']\' (状態: visible) が現在のスコープおよび探索可能なiframe (深さ2まで) 内で見つかりませんでした。\\"\\n  }\\n]"\n  }\n]'}
2025-04-19 18:47:19,782 - [INFO] [__main__:145] 詳細結果/エラー情報を保存: Google_Search_Scenario_step1_error.json
2025-04-19 18:47:19,784 - [INFO] [__main__:123] サマリ結果追記: web_runner_mcp_llm_batch_output.txt <- Google_Search_Scenario
2025-04-19 18:47:20,789 - [INFO] [__main__:284] --- バッチテスト完了 ---
